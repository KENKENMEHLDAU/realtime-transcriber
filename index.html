<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­—å¹• Liteï¼ˆè‹±â†’æ—¥ï¼‰â€” ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸è¦</title>
<style>
  :root{--bg:#0b1220;--panel:#0f172a;--text:#e5e7eb;--muted:#9fb3c8;--border:#243041;--accent:#22c55e;--danger:#ef4444}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{padding:16px 12px;text-align:center} h1{margin:0;font-size:clamp(18px,3vw,24px)}
  .app{max-width:1100px;margin:0 auto;padding:0 12px 22px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .card{background:rgba(17,24,39,.7);border:1px solid var(--border);border-radius:12px;padding:12px}
  button,select{padding:9px 12px;border-radius:10px;border:1px solid var(--border);background:#0d1424;color:#fff}
  button.primary{background:var(--accent);border-color:transparent;color:#06250f;font-weight:700}
  button.danger{background:var(--danger);border-color:transparent}
  button:disabled{opacity:.6;cursor:not-allowed}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .pane{background:#0b1220;border:1px solid var(--border);border-radius:12px;min-height:320px;padding:10px;overflow:auto;line-height:1.6}
  .pane h3{margin:6px 0 8px 0;font-size:14px;color:#b7c6dc}
  .line{margin:6px 0}
  .ts{color:#8ea6c8;font-family:ui-monospace,Consolas,Menlo,monospace;margin-right:6px}
  .tools{display:inline-flex;gap:6px;margin-left:6px}
  .status{font-size:12px;color:#9fb3c8}
  .warn{background:#3b2f00;border:1px solid #7c5c00;color:#ffe08a;padding:8px;border-radius:8px;margin-top:8px}
  .mono{font-family:ui-monospace,Consolas,Menlo,monospace}
</style>
</head>
<body>
<header>
  <h1>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŒ²éŸ³ â†’ æ–‡å­—èµ·ã“ã—ï¼ˆå·¦ï¼šè‹±èª / å³ï¼šæ—¥æœ¬èªï¼‰â€” Lite</h1>
  <div class="status">â€» ãƒ–ãƒ©ã‚¦ã‚¶å†…è”µã®éŸ³å£°èªè­˜ã®ã¿ã‚’ä½¿ç”¨ã€‚å¤–éƒ¨ãƒ¢ãƒ‡ãƒ«DLä¸è¦ã€‚ç¿»è¨³ã¯ DeepL ã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§é–‹ãã¾ã™ã€‚</div>
</header>

<div class="app">
  <div class="card">
    <div class="row">
      <label>èªè­˜è¨€èª
        <select id="langSel">
          <option value="en-US" selected>English (US)</option>
          <option value="en-GB">English (UK)</option>
        </select>
      </label>
      <button id="startBtn" class="primary">ğŸ™ï¸ é–‹å§‹</button>
      <button id="stopBtn" class="danger" disabled>â¹ åœæ­¢</button>
      <span id="stat" class="status">æº–å‚™OKï¼šé–‹å§‹ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼ˆChrome æ¨å¥¨ï¼‰</span>
    </div>
    <div class="warn" id="compat" style="display:none">
      ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ <b>Web Speech APIï¼ˆéŸ³å£°èªè­˜ï¼‰</b> éå¯¾å¿œã§ã™ã€‚Chrome/Edge ã‚’ãŠä½¿ã„ãã ã•ã„ã€‚
    </div>
  </div>

  <div class="grid" style="margin-top:12px">
    <div class="card"><div class="pane" id="paneEn"><h3>English (ASR)</h3></div></div>
    <div class="card"><div class="pane" id="paneJa"><h3>æ—¥æœ¬èªè¨³</h3><div class="status">å„è¡Œã® ğŸ”— ã‚’æŠ¼ã™ã¨ DeepL ã§ç¿»è¨³ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</div></div></div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="status mono" id="log"></div>
  </div>
</div>

<script>
const logEl=document.getElementById('log'), stat=document.getElementById('stat');
const paneEn=document.getElementById('paneEn'), paneJa=document.getElementById('paneJa');
const startBtn=document.getElementById('startBtn'), stopBtn=document.getElementById('stopBtn');
const langSel=document.getElementById('langSel');
const log=(m)=>{logEl.textContent+=(logEl.textContent?'\n':'')+m;logEl.scrollTop=logEl.scrollHeight;};
const tfmt=(s)=>{const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(Math.floor(s%60)).padStart(2,'0'); return mm+':'+ss;};

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
if(!SR){ document.getElementById('compat').style.display='block'; }

let recog=null, running=false, t0=0;
function addLine(timeSec, text){
  // å·¦ï¼ˆè‹±èªï¼‰
  const enLine=document.createElement('div'); enLine.className='line';
  const ts=document.createElement('span'); ts.className='ts'; ts.textContent='['+tfmt(timeSec)+'] ';
  const sp=document.createElement('span'); sp.textContent=text;
  const tools=document.createElement('span'); tools.className='tools';
  const btn=document.createElement('button'); btn.textContent='ğŸ”— DeepL'; btn.title='ç¿»è¨³ã‚’DeepLã§é–‹ã';
  btn.onclick=()=>{ const url='https://www.deepl.com/translator#en/ja/'+encodeURIComponent(text); window.open(url,'_blank'); };
  tools.appendChild(btn);
  enLine.appendChild(ts); enLine.appendChild(sp); enLine.appendChild(tools);
  paneEn.appendChild(enLine); paneEn.scrollTop=paneEn.scrollHeight;

  // å³ï¼ˆæ—¥æœ¬èªæ¬„ã«ã¯ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤ºï¼‰
  const jaLine=document.createElement('div'); jaLine.className='line';
  const ts2=document.createElement('span'); ts2.className='ts'; ts2.textContent='['+tfmt(timeSec)+'] ';
  const hint=document.createElement('span'); hint.textContent='ï¼ˆã“ã®è¡Œã‚’ DeepL ã§é–‹ãã«ã¯å·¦ã® ğŸ”— ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼‰';
  jaLine.appendChild(ts2); jaLine.appendChild(hint);
  paneJa.appendChild(jaLine); paneJa.scrollTop=paneJa.scrollHeight;
}

function start(){
  if(!SR){ stat.textContent='éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ã™ã€‚'; return; }
  recog=new SR(); recog.lang=langSel.value; recog.continuous=true; recog.interimResults=true;
  recog.onstart=()=>{ running=true; t0=performance.now(); stat.textContent='è´å–ä¸­â€¦ è©±ã—ã‹ã‘ã¦ãã ã•ã„'; };
  recog.onresult=(ev)=>{
    for(let i=ev.resultIndex;i<ev.results.length;i++){
      const res=ev.results[i], txt=res[0].transcript.trim();
      if(!txt) continue;
      if(res.isFinal){ const t=((performance.now()-t0)/1000); addLine(t, txt); }
    }
  };
  recog.onerror=(e)=>{ log('SpeechRecognition error: '+(e.error||e.message||e)); stat.textContent='ã‚¨ãƒ©ãƒ¼: '+(e.error||e.message||e); };
  recog.onend=()=>{ running=false; if(stopBtn.disabled===false){ try{ recog.start(); }catch{} } };
  try{ recog.start(); startBtn.disabled=true; stopBtn.disabled=false; }catch(e){ stat.textContent='é–‹å§‹å¤±æ•—: '+(e.message||e); }
}
function stop(){ try{ recog&&recog.stop(); }catch{} running=false; startBtn.disabled=false; stopBtn.disabled=true; stat.textContent='åœæ­¢ã—ã¾ã—ãŸ'; }

startBtn.addEventListener('click', start);
stopBtn.addEventListener('click', stop);
</script>
</body>
</html>
